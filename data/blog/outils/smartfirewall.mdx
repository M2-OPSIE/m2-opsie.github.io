---
title: SmartFirewall - Estimation de règles de firewall
date: '2026-02-14'
tags: ['sécurité', 'firewalls', 'SOC', 'réseau', 'visualisation','outils']
draft: false
summary: Un outil capable d'estimer des règles de firewall et d'aider la mise en place a l'aide de visualisation de données 
---


![Bannière](/static/images/smartfirewall/banner.png)

Cet outil a été réalisé par un étudiant de la promotion M2 OPSIE 2025-2026.
Le code source est disponnible sur [GitHub](https://github.com/EliasBaroudi/smartfirewall)

SmartFirewall est un analyseur de trafic réseau et un générateur de règles de pare-feu. Son objectif principal est d’aider à la configuration du firewall. Il lit des fichiers PCAP/PCAPNG, analyse les flux réseau, génère des sorties aux formats CSV, SQLite ou Elasticsearch, et peut visualiser le trafic à l’aide d’AfterGlow.

Les graphiques générés par AfterGlow ou Elasticsearch sont destinés à orienter votre analyse. Vous devez les examiner attentivement et les interpréter avec réflexion afin de définir des règles de pare-feu cohérentes et efficaces.

## Fonctionnalités

* Analyse des fichiers PCAP/PCAPNG depuis le répertoire `/data`
* Génération automatique de règles de pare-feu
* Export des résultats en CSV, SQLite ou Elasticsearch
* Visualisation des flux réseau avec AfterGlow (Linux uniquement)
* Configuration complète via le fichier config.py
* Compatible Docker pour un déploiement simplifié

## Installation

1. Cloner le repository

```bash
git clone https://github.com/EliasBaroudi/smartfirewall/
cd smartfirewall
```

2. Installer les dépendances Python :

```bash
pip install -r requirements.txt
```

3. Placez vos fichiers PCAP dans le répertoire ./data/.

## Dépendances optionnelles

### AfterGlow (Linux uniquement)

AfterGlow est utilisé pour générer des graphiques de visualisation du réseau.

1. Téléchargez afterglow.pl depuis le dépôt officiel :
https://github.com/zrlram/afterglow 

2. Placez le fichier afterglow.pl à la racine du projet (au même niveau que script.p)

3. Assurez-vous que Perl, libtext-csv-perl et Graphviz (neato) sont installés sur votre système.

```bash
apt install -y libtext-csv-perl
apt install -y graphviz
```

### Elasticsearch

Pour utiliser Elasticsearch, vous devez créer un réseau Docker et y exécuter une instance Elasticsearch :

```bash
docker create network smfw_lan
docker-compose up -d 
```

Pour plus d’informations, consultez :
https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-with-docker

## Configuration

Modifiez `config.py` pour ajuster :

* Les fonctionnalités CSV, SQLite, Elasticsearch ou AfterGlow
* Les répertoires d’entrée et de sortie
* Les seuils (ports et serveurs)

Personnalisez l’apparence d’AfterGlow dans `sample.properties`.

## Utilisation

### Exécution locale avec Python

```bash
python script.py
```

### Exécution avec Docker

```bash
docker run --rm --network=smfw_lan -it -v ./:/app smartfirewall python script.py
```

Note :

* Remplacez `smfw_lan` par le réseau Docker utilisé par votre instance Elasticsearch si nécessaire.  
* Vous pouvez supprimer l’option `--network` si vous n’utilisez pas Elasticsearch.  
* Si Elasticsearch est exécuté en dehors de Docker, veillez à mettre à jour la variable `elastic_url` dans `config.py`.  
*  Vous devrez créer une Data View dans Elasticsearch afin d’accéder aux index générés.
![Data view](/static/images/smartfirewall/dataview.png)


## Résultats générés
* Logs CSV : ./output/YYYY-MM-DD_HH-MM/csv.csv  
* Base de données SQLite : ./output/YYYY-MM-DD_HH-MM/db.db 
* Index Elasticsearch : smart_fw_YYYY-MM-DD_HH-MM  
* Règles de pare-feu : ./output/YYYY-MM-DD_HH-MM/rules.txt
* Visualisation AfterGlow : ./output/YYYY-MM-DD_HH-MM/graph.png (Linux uniquement)

# Exemple d'utilisation

1. Exécution du script 

```bash
docker run --rm --network=smfw_lan -it -v ./:/app smartfirewall python script.py
```

```
####### LOADING FILES #######
File : ./data/ultimate_pcap.pcapng
[*] Loading.
[+] Done


####### READING PACKETS #######
[================================================= ] 100%

####### EXPORTING DATA #######
[+] CSV exported to: ./output/08-02-2026_21-09/csv.csv
[+] Database exported to: ./output/08-02-2026_21-09/db.db
[+] Index created successfully
[+] Visualization exported to: ./output/08-02-2026_21-09/graph.png


####### OPTIMIZING RULES #######
[*] Removing rules where source and destination IPs are in the same network
[*] Grouping rules by network CIDR


####### GENERATING RULES #######
[+] Rules file saved to: ./output/08-02-2026_21-09/rules.txt
``` 

2. Règles générées dans `rules.txt`

```bash
# Generated by SmartFireWall on Sun Feb  8 21:09:30 2026
# Files : ./data/ultimate_pcap.pcapng

# User conf : 
# config.dir_input : ./data/
# config.dir_output : ./output/
# config.dir_output : ./output/
# config.user_csv : True
# config.user_db : True
# config.user_elastic : True
# config.auto_any_rules : False
# config.remove_same_network : True
# config.max_uniques_ports : 20
# config.tcp_random_range : range(32768, 65536)
# config.global_port_threshold : 20
# config.public_server_threshold : 15

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -s 172.16.81.99 -d 172.16.80.10 -p tcp --dport 53 -j ACCEPT
-A INPUT -s 172.16.81.99 -d 172.16.80.10 -p udp --dport 389 -j ACCEPT
-A INPUT -s 192.168.3.53 -d 172.16.80.10 -p tcp -m multiport --dports 53,88 -j ACCEPT
-A INPUT -s 192.168.121.0/24 -d 224.0.0.102 -p udp --dport 1985 -j ACCEPT
...
-A INPUT -j DROP
COMMIT
```

3. Graphique des flux (Afterglow) 
![Graphique](/static/images/smartfirewall/graph.png)

4. Visualisation dans Elasticsearch
![tableau de bord](/static/images/smartfirewall/dashboard.png)

---

BAROUDI Elias, GHLAMI Nassim
